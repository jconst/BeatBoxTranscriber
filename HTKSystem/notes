# create word net
HParse gram wdnet

# find the list of words (prompts is given)
perl needed/prompts2wlist needed/prompts wlist

# add sent-start and sent-end to the word list
perl needed/addsentstart.pl

# construct your dictionary
HDMan -m -w wlist -n monophones1 -l dlog dict needed/beep needed/names 

# make monophones0 -- remove sp from monophones1
perl needed/createmonophones0.pl

HSGen -l -n 200 wdnet dict > testprompts
HSGen -l -n 50 wdnet dict > testprompts2
perl needed/prompts2mlf words.mlf needed/TestPrompts/testprompts
HLEd -l '*' -d dict -i phones0.mlf mkphones0.led words.mlf

# create training scripts
perl needed/createscript.pl
HCopy -T 1 -C needed/config -S codetr.scp

# create hmm0
mkdir hmm0

# create proto
perl needed/createproto.pl
HCompV -C needed/config -f 0.01 -m -S train.scp -M hmm0 proto
perl needed/createhmmdefs.pl hmm0

# create hmm1, hmm2, hmm3
mkdir hmm1
mkdir hmm2
mkdir hmm3

# do for hmm1, hmm2, hmm3
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm0/macros -H hmm0/hmmdefs -M hmm1/ monophones0
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm1/macros -H hmm1/hmmdefs -M hmm2/ monophones0
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm2/macros -H hmm2/hmmdefs -M hmm3/ monophones0

# create hmm4
mkdir hmm4

# create an sp model
perl needed/makeSPmodel.pl hmm3

# create hmm5
mkdir hmm5

# tie sp to center sil state
HHEd -H hmm4/macros -H hmm4/hmmdefs -M hmm5 sil.hed monophones1

# create hmm6, hmm7
mkdir hmm6
mkdir hmm7

# two more passes of HERest
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm5/macros -H hmm5/hmmdefs -M hmm6/ monophones1
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm6/macros -H hmm6/hmmdefs -M hmm7/ monophones1

# add silence to the dictionary
perl needed/addsilence.pl

# create label files
perl needed/createlab.pl

# run Viterbi decoding
HVite -l '*' -o SWT -b silence -C needed/config -a -H hmm7/macros -H hmm7/hmmdefs -i aligned.mlf -m -t 250.0 -y lab -I words.mlf -S train.scp dict monophones1

# create hmm8, hmm9
mkdir hmm8
mkdir hmm9

# two more passes of HERest
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm7/macros -H hmm7/hmmdefs -M hmm8/ monophones1
HERest -C needed/config -I phones0.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm8/macros -H hmm8/hmmdefs -M hmm9/ monophones1

# Run Viterbi
HVite -H hmm9/macros -H hmm9/hmmdefs -S test.scp -l '*' -i recout.mlf -w wdnet -p 0.0 -s 5.0 dict monophones1
HResults -I words.mlf monophones1 recout.mlf 

--------------------

# create triphones from monophones
HLEd -n triphones1 -l '*' -i wintri.mlf mktri.led aligned.mlf

# create hmm10
mkdir hmm10

# create mktri.hed
perl needed/maketrihed monophones1 triphones1

# clone models
HHEd -B -H hmm9/macros -H hmm9/hmmdefs -M hmm10 mktri.hed monophones1

# create label files
perl needed/createlab.pl

# create hmm11, hmm12
mkdir hmm11
mkdir hmm12

# HERest
HERest -C needed/config -I wintri.mlf -t 250.0 150.0 1000.0 -S train.scp -H hmm10/macros -H hmm10/hmmdefs -M hmm11/ triphones1
HERest -C needed/config -I wintri.mlf -t 250.0 150.0 1000.0 -s stats -S train.scp -H hmm11/macros -H hmm11/hmmdefs -M hmm12 triphones1

# create hmm13
mkdir hmm13

# generate the new triphone dictionary
HDMan -b sp -n fulllist -g global.ded -l flog beep-tri needed/beep

# concatenate fulllist and triphones1 into a new file fulllist1
cat fulllist triphones1 > fulllist1

# remove redundancy and rename
perl needed/fixfulllist.pl fulllist1 fulllist

# decision tree state tying
HHEd -H hmm12/macros -H hmm12/hmmdefs -M hmm13 needed/tree.hed triphones1 > log

# create hmm14, hmm15
mkdir hmm14
mkdir hmm15

# HERest
HERest -B -C needed/config -I wintri.mlf -t 250.0 150.0 1000.0 -s stats -S train.scp -H hmm13/macros -H hmm13/hmmdefs -M hmm14 tiedlist
HERest -B -C needed/config -I wintri.mlf -t 250.0 150.0 1000.0 -s stats -S train.scp -H hmm14/macros -H hmm14/hmmdefs -M hmm15 tiedlist

# Run Viterbi
HVite -H hmm15/macros -H hmm15/hmmdefs -S test.scp -l '*' -i recout.mlf -w wdnet -p 0.0 -s 5.0 dict tiedlist
HResults -I words.mlf monophones1 recout.mlf 

--------------------

